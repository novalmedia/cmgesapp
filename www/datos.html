<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="description"content="Club Mascodin" />

<title>Club Mascodin</title>
    

<link rel="stylesheet" type="text/css" href="css/index.css" />
<link rel="stylesheet" type="text/css" href="css/jquery.mobile.css" />

<link rel="stylesheet" type="text/css" href="css/jquery.mobile.icons.css" />
</head>
<body style="display: none;">
<div data-role="page" id="datos"> 
  <div data-role="header" class="header" data-position="fixed"  data-theme="b"> 
	<a href="index.html" class="ui-btn-right" id="clublogo"></a>
		<h1>CLUB MASCODIN</h1> 
    <a href="#panel" id="abre_panel" class="panel-btn"></a> 
  </div> 
   
   <div data-role="panel" id="panel" data-position-fixed="true" data-position="left" data-display="overlay"> 
	<div id="menu_header">
		<h3 class="private">Hola <span id="pname"></span></h3><h4 class="private">Socio seleccionado: <span id="sociog">Ninguno</span></h4>
		<p class="private"><a href="cambiar.html">Cambiar</a></p>
	</div>
    <ul data-role="listview"> 
		<li><a class="ui-icon-power ui-btn-icon-left loginlink" href="login.html">Acceso </a></li>
				<li class="private"><a class="ui-icon-user ui-btn-icon-left"  href="nuevo.html" class="panel_li"  >Nuevo socio</a></li> 
		<li class="private"><a class="ui-icon-user ui-btn-icon-left"  href="datos.html" class="panel_li"  >Datos socio</a></li> 
		<li class="private"><a class="ui-icon-heart ui-btn-icon-left"  href="mascotas.html" class="panel_li"  >Mascotas socio</a></li> 
		<li class="private"><a class="ui-icon-calendar ui-btn-icon-left"  href="citas.html" class="panel_li"  >Pedir cita</a></li> 
		<li class="private"><a class="ui-icon-mail ui-btn-icon-left"  href="mensajes.html" class="panel_li"  >Mensajes socio</a></li>
		<li class="private"><a class="ui-icon-star ui-btn-icon-left"  href="recordatorios.html" class="panel_li"  >Record. socio</a></li>
		<li class="private"><a class="ui-icon-power ui-btn-icon-left" href="logout.html">Salir</a></li>
	</ul>
  </div> 

  <div data-role="content" style="margin-bottom: 100%;"> 
	 <div id="userForm" >
		<h3 style="text-align: center;">Datos personales</h3>
		<div id="chgsocio" style="display: none">
			<a href="#" onclick="chgsocio();" data-role="button">Cambiar Socio</a>
		</div>
		<div id="selsocios">
		 <div data-role="fieldcontain">
			<input class="search" type="text" name="search" id="search" value="" placeholder="Buscar socio" />
			<a href="#" onclick="searchuser(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-search ui-btn-icon-notext">&nbsp;</a>
		 </div>
		 <div id="sociosSelectContainer"  style="display: none;">
		 <hr  style="margin-top: 5px;display: inline-block;width: 100%;" />
		<select name="sociosSelect" id="sociosSelect"><option>Selecciona socio</option></select>
		</div>
		</div>
		<div id="datossocios" style="display: none">
			<h3>Socio <span id="numsocio"></span></h3>
			 <div data-role="fieldcontain">
				<span id="name" class="ui-icon-user ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#iname').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
					<input class="userdata" type="text" name="name" id="iname" value="" />
					<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 <div data-role="fieldcontain">
				<span id="email" class="ui-icon-mail ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#iemail').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="text" name="email" id="iemail" value=""/>
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			  <div data-role="fieldcontain">
				<span id="birthDate" class="ui-icon-calendar ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#ibirthDate').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="date" data-clear-btn="false" name="birthDate" id="ibirthDate" value="" />
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 <div data-role="fieldcontain">
				<span id="address1" class="ui-icon-home ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide(); $('#iaddress1').focus();return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="text" name="address1" id="iaddress1" value=""/>
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 <div data-role="fieldcontain">
				<span id="city" class="ui-icon-location ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#icity').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="text" name="city" id="icity" value="" />
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 <div data-role="fieldcontain">
				<span id="postal_code" class="ui-icon-location ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#ipostal_code').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="text" name="postal_code" id="ipostal_code" value="" />
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 <div data-role="fieldcontain">
				<span id="phone" class="ui-icon-phone ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#iphone').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<input class="userdata" type="text" name="phone" id="iphone" value="" />
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 
			 <div data-role="fieldcontain">
				<span id="block" class="ui-icon-forbidden ui-btn-icon-left"></span>
				<a href="#" onclick="$(this).next().show();$(this).hide();$(this).prev().hide();$('#iblock').focus(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-edit ui-btn-icon-notext">&nbsp;</a>
				<div style="display: none;">
				<select class="userdata" name="block" id="iblock" data-role="slider">
					<option value="1">Bloqueado</option>
					<option value="0">Activo</option>
				</select>
				<a href="#" onclick="saveData(); return false;" class="ui-btn ui-btn-icon-right ui-corner-all ui-icon-check ui-btn-icon-notext">&nbsp;</a>
				</div>
			 </div>
			 
		 <hr  style="margin-top: 10px;display: inline-block;width: 100%;" />
		 <div style="margin-top: 10px;display: inline-block;width: 100%;"><a href="chgpwd.html" data-role="button">Cambiar contrase√±a</a></div>
		 </div>
	</div> 
  </div> 

</div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/maindatos.js"></script>
	<script type="text/javascript" src="PushNotification.js"></script>

	<script type="text/javascript">
			app.initialize();
			$(document).bind("mobileinit", function () {
				$.mobile.ajaxEnabled = false;
			});
			$(document).on("pageshow", '#datos', function(){
				$('body').fadeIn();
				$("div:jqmData(role='panel')").css('margin-top',  ($("div:jqmData(role='header')").height()));
				if(window.localStorage["socio"] != undefined && window.localStorage["name"] != undefined) {
					 
					$("#pname").html(window.localStorage["name"]);$("#sociog").html(window.localStorage["sociog"]);
					/*$("#iname").val(window.localStorage["name"]);
					$("#name").html(window.localStorage["name"]);
					$("#iemail").val(window.localStorage["email"]);
					$("#email").html(window.localStorage["email"]);
					$("#ibirthDate").val(window.localStorage["birthDate"]);
					$("#birthDate").html(window.localStorage["birthDate"]);
					$("#iaddress1").val(window.localStorage["address1"]);
					$("#address1").html(window.localStorage["address1"]);
					$("#icity").val(window.localStorage["city"]);
					$("#city").html(window.localStorage["city"]);
					$("#ipostal_code").val(window.localStorage["postal_code"]);
					$("#postal_code").html(window.localStorage["postal_code"]);
					$("#iphone").val(window.localStorage["phone"]);
					$("#phone").html(window.localStorage["phone"]); */
					
					$(".private").removeClass('private');
					$(".loginlink").hide();
				}
				if (window.localStorage["socionum"] != undefined){
					loadsocio(window.localStorage["socionum"]);
				}
				
			});
			function saveData(){
				var data= {};
				$('.userdata').each(function(){
					data[$(this).attr('name')] = $(this).val();
					window.localStorage[$(this).attr('name')] = $(this).val();
				})
			
				var uid = window.localStorage["useridg"];
				var u = window.localStorage["username"];
				var p = window.localStorage["password"];
				$.post("http://www.clubmascodin.com/app/saveuserdatag.php", {userid:uid, data: data, u:u, p:p}, function(res) {
					if (res==true){
						navigator.notification.alert("Datos guardados", function() {});
						$("#datossocios div:jqmData(role='fieldcontain') > div").hide();
						$("#datossocios div:jqmData(role='fieldcontain') > span").show();
						$('.ui-icon-edit').show();
						$("#name").html(window.localStorage["name"]);
						$("#email").html(window.localStorage["email"]);
						$("#birthDate").html(window.localStorage["birthDate"]);
						$("#address1").html(window.localStorage["address1"]);
						$("#city").html(window.localStorage["city"]);
						$("#postal_code").html(window.localStorage["postal_code"]);
						$("#phone").html(window.localStorage["phone"]);
						$("#block").html(window.localStorage["block"]==1?'Bloqueado':'Activo');

					}
				},"json");
			}
			
			
			function searchuser(){
				var data= $("#search").val();
				
				var u = window.localStorage["username"];
				var p = window.localStorage["password"];
				$.post("http://www.clubmascodin.com/app/searchuser.php", {data: data, u:u, p:p}, function(res) {
					if (res != false){
					
						$('#sociosSelect').empty().append($('<option>').text('Selecciona socio'));
						
						var options = res;
						var length = options.length;

						for(var j = 0; j < length; j++)
						{
							$('#sociosSelect').append($('<option>').text(options[j].Text).attr('value', options[j].Value));
							
						}
						$('#sociosSelectContainer').show();
						$("#search").val('');
						$('#sociosSelect').focus();
					}
				},"json");
			}
			
			
			$( "#sociosSelect" ).change(function() {
				var userid = $( "#sociosSelect" ).val();
				loadsocio(userid);
			});
	
	function loadsocio(userid){
		var u = window.localStorage["username"];
		var p = window.localStorage["password"];
		$.post("http://www.clubmascodin.com/app/getuserdata.php", {userid: userid, u:u, p:p}, function(res) {
			if (res != false){
				window.localStorage["useridg"] = res["id"];
				window.localStorage["sociog"] = res["name"];
				window.localStorage["socionum"] = res["username"];
				$("#numsocio").html(res["username"]);
				$("#iname").val(res["name"]);
				$("#name").html(res["name"]);
				$("#iemail").val(res["email"]);
				$("#email").html(res["email"]);
				$("#ibirthDate").val(res["birthDate"]);
				$("#birthDate").html(res["birthDate"]);
				$("#iaddress1").val(res["address1"]);
				$("#address1").html(res["address1"]);
				$("#icity").val(res["city"]);
				$("#city").html(res["city"]);
				$("#ipostal_code").val(res["postal_code"]);
				$("#postal_code").html(res["postal_code"]);
				$("#iphone").val(res["phone"]);
				$("#phone").html(res["phone"]);
				
				$("#iblock").val(res["block"]);
				$("#block").html(res["block"]==1?'Bloqueado':'Activo');
				
				$("#selsocios").hide();
				$("#chgsocio").fadeIn();
				$("#datossocios").fadeIn();
			}
		},"json");
	}
			
	function chgsocio()
	{
		$("#chgsocio").hide();
		$("#datossocios").hide();
		$("#selsocios").fadeIn();
		
		return false;
	}
			
	 $(".userdata").focus(function(e) {
		var container = $( this ).parent(),
			scrollTo = $( this );

		setTimeout((function() {
			$("html, body").animate({
			scrollTop: scrollTo.offset().top - ($('.header').height()*2)
			});
		}), 500);

	});
			
    </script>
    <script type="text/javascript" src="js/jquery.mobile.js"></script>
</body>
</html>
